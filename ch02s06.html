<html><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r"><title>Что нового в версии 4.2 по сравнению с 4.1.5?</title><link rel="stylesheet" href="chs/default.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.1"><link rel="home" href="index.html" title="Краткий учебник по sed."><link rel="up" href="ch02.html" title="Глава 2."><link rel="prev" href="ch02s05.html" title="sed FAQ (ЧАВО)"><link rel="next" href="ch03.html" title="Глава 3. man sed (русский перевод)"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Что нового в версии 4.2 по сравнению с 4.1.5?</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch02s05.html">Пред.</a> </td><th width="60%" align="center">Глава 2. </th><td width="20%" align="right"> <a accesskey="n" href="ch03.html">След.</a></td></tr></table><hr></div><div class="section" title="Что нового в версии 4.2 по сравнению с 4.1.5?"><div class="titlepage"><div><div><h3 class="title"><a name="id2516262"></a><a name="whatsnew"></a>Что нового в версии 4.2 по сравнению с 4.1.5?</h3></div></div></div><p>
			Ну в инет мну почему-то не пустили, какая-то хрень с провайдером, звонить мне
			ему лениво, потому я лучше посмотрю, что у нас появилось нового в sed, а то даже
			в последней Slackware 13.0 (хотя на днях и вышла 13.1, но я её ещё не поставил)
			версия всего-лишь 4.1.5.
		</p><p>
			Первое, что бросилось в глаза - изменилось описание моего любимого бага, а
			именно теперь рекомендуют для очистки буфера использовать не команду
			<span class="command"><strong>s/.*//</strong></span>, а команду <span class="command"><strong>z</strong></span>. Ну или как раньше:
			изменить значение системных переменных.
		</p><p>
			Так-же сменилась лицензия на третью версию.
		</p><p>
			</p><pre class="programlisting">
&gt; 2009-01-05  Paolo Bonzini  &lt;bonzini@gnu.org&gt;
&gt; 
&gt;         * execute.c (read_pattern_space): Reset hold space at end-of-file
&gt; 	if input-&gt;reset_at_next_file.
&gt;
			</pre><p>
			Вот оно как! Это я что-то не понял, раньше что-ли область удержания НЕ очищалась после каждого файла?! Чего только не вычитаешь в чейнджлоге... Я думал - она ВСЕГДА очищается перед каждым новым файлом...
		</p><p>
			Чё-то намутили опять с POSIX MODE, впрочем - мне это не очень важно, я его не использую. Надеюсь лучшее соответствие стандарту пригодится тем, кто этот стандарт соблюдает. Меня стандарт не устраивает тем, что там слишком мало опций, а на всех МОИХ системах работает версия GNU, потому меня это не сильно взволновало...
		</p><p>
			А вот это уже интереснее:</p><pre class="programlisting">
&gt; 2008-09-29  Paolo Bonzini  &lt;bonzini@gnu.org&gt;
&gt; 
&gt; 	* BUGS: Document s/.*.// behavior with invalid multibyte sequences.
&gt; 	* NEWS: Document `z' extension.
&gt;</pre><p>
			Исправили поведение в случае НЕСИМВОЛОВ, если используется такой хитрый шаблон. Отлично. Хорошо, что я обновился. Это довольно опасная дыра. Впрочем, я ещё в коде пошукаю, мож там что-то более интересное. Ну и, как я уже неоднократно писал, добавили <span class="command"><strong>z</strong></span>.
		</p><p>
			А, ещё тест новый добавили - с несимволом. Надо бы проверить, как теперь моя "уязвимость" работает... Вот щаз и проверю...
		</p><p>
			Проверил - как и следовало ожидать - "уязвимость" осталась. Ну хорошо, что всё работает именно так, как я этого ожидал. Видимо в каких-то случаях sed тут выкидывала неожиданности. Что-ж, на сервере sed я уже давно обновил, ещё в том году. Что и вам рекомендую. (даже если вы терпеть не можете sed, то в ВАШИХ системах она всё равно используется. Можете проверить сами.)
		</p><p>
			&gt; * new option --follow-symlinks, вот, новая опция появилась. Она действует вместе с редактированием "на месте", т.е. в том случае, когда файл идёт в поток, а потом, после редактирования, он возвращается обратно в файл. Очень любопытно, как в таком случае будет проходить редактирование, если права на каталог с симлинком RO? Это зависит от того, где sed создаст свой временный файл, если она задумает создать его там-же, где симлинк... Впрочем, пойду проверю.
		</p><p>
			Ага. В прошлой версии имеется баг: при попытке отредактировать симлинк sed 4.1.5 создаёт временный файл там где симлинк, и после редактирования убивает симлинк, и ставит на его место временный файл.
		</p><p>
			Новая версия ведёт себя точно так-же. Это без опции <code class="option">--follow-symlinks</code>. А вот с опцией поведение именно такое, как и ожидается: действия производятся именно над файлом, а не над симлинком.
		</p><p>
			</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
					ещё мну vim расстроил: вот там табы сделали, но убейте мну апстену, или объясните, по каким таким причинам, до сих пор не сделали отдельную кодировку в каждом табе?! В итоге - в одном месте нормально, в другом - кракозябры :-( Надеюсь завсегдатые SLOR'а этого не читают :-)
				</p><p>
					...Странно... Почему-то теперь работают кодировки в табах...
				</p></div><p>
			Вот. А ещё чё-то я не понял совсем фразы о том, что дескать опцию --follow-symlinks нельзя юзать обычным юзверям. А дескать, в будущем доделают. 
			Вот только я не очень понял, чем это всё грозит простым юзерам, да и вообще системе в целом. Вот убейте - не догоняю... Сам я эту опцию поюзал, и она вроде нормально работает. 
			Именно так, как я и ожидал - например я отредактировал файл рута, и этот файл сохранил свои права (444, только чтение), но сменил хозяина и временнЫе метки. Впрочем, я так-же делал и напрямую, а не через симлинк. 
			Если у рута хватит мозгов закрыть от меня каталог где файл (*НЕ* симлинк!), то я с этим файлом ничего и не смогу сделать - начнём с того, что я не смогу создать там временный файл. Впрочем...
		</p><p>
			Неа, думал, что через симлинки можно атаковать каталоги, на которые установлен атрибут AppendOnly. Неа, что через симлинки, что просто так получается фигня: Временный файл создаётся. Однако, в этот файл невозможно ничего записать! Мало того, не работает команда копирования. А вот команда переноса - работает. Смешные каталоги. Ну а раз нельзя менять файлы в таком каталоге, то и удалить такой файл невозможно. Не каталог, а ловушка - если туда файл попал, то он там как муха в янтаре вязнет, и никто не может их удалить или изменить (даже рут), но вот отправить туда файл может кто угодно. Видимо такие каталоги удобно делать для бекапов и бекапов логов, кто угодно может туда отправить, но вот изменить там ничего не возможно. Причём, что самое интересное - с другого раздела тоже не перенести. Действительно, операция mv с раздела на раздел работает как cp src dest; rm src, а вот внутри раздела - ln src dest; rm src. Так-же можно сделать жёсткую ссылку на файл внутри защищённого каталога.
		</p><div class="blockquote"><blockquote class="blockquote"><p>
		Вы можете обсудить этот документ на <a class="ulink" href="http://forum.drbatty.ru/viewtopic.php?f=19&amp;t=5026" target="_top">форуме</a>. Текст предоставляется по лицензии <a class="ulink" href="http://www.gnu.org/licenses/fdl.html" target="_top">GNU Free Documentation License</a> (<a class="ulink" href="http://forum.lorcode.org/viewtopic.php?f=15&amp;t=30" target="_top">Перевод лицензии GFDL</a>).
	</p><p>
		Вы можете пожертвовать небольшую сумму яндекс-денег на счёт <span class="command"><strong>41001666004238</strong></span> для оплаты хостинга, интернета, и прочего. Это конечно добровольно, однако это намного улучшит данный документ (у меня будет больше времени для его улучшения). На самом деле, проект часто находится на грани закрытия, ибо никаких денег никогда не приносил, и приносить не будет. Вы можете мне помочь. Спасибо.
	</p></blockquote></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch02s05.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="ch02.html">Уровень выше</a></td><td width="40%" align="right"> <a accesskey="n" href="ch03.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">sed FAQ (ЧАВО) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Глава 3. man sed (русский перевод)</td></tr></table></div></body></html>
